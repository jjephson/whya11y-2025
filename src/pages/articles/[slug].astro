---
import BlogLayout from '../../layouts/BlogLayout.astro';
import PageHeader from '../../components/PageHeader.astro';
import { getCollection } from 'astro:content';

/**
 * Article Page Template
 * 
 * This page renders individual articles from the content/articles collection.
 * 
 * HOW TO CREATE AN ARTICLE:
 * 1. Create a new .md file in src/content/articles/
 * 2. Add frontmatter with: title, description, date, and optional headerImage
 * 3. Write your content using markdown
 * 
 * OPTIONAL FRONTMATTER FIELDS:
 * - wcagCriteria: Array of WCAG criteria this article addresses
 * - keyTakeaways: Array of key points from the article
 * - whoBenefits: Array of user groups who benefit
 * - relatedResources: Array of related links
 * - furtherReading: Array of additional reading materials
 * 
 * EXAMPLE FRONTMATTER:
 * ---
 * title: "Your Article Title"
 * description: "Brief description of what this article covers"
 * date: "2024-12-19"
 * headerImage: "https://example.com/image.jpg" (optional)
 * wcagCriteria:
 *   - code: "1.3.1"
 *     title: "Info and Relationships"
 *     url: "https://www.w3.org/WAI/WCAG21/quickref/#info-and-relationships"
 * keyTakeaways:
 *   - "Key point 1"
 *   - "Key point 2"
 * ---
 */

export async function getStaticPaths() {
	const articles = await getCollection('articles');
	return articles.map(article => ({
		params: { slug: article.slug },
		props: { article },
	}));
}

const { article } = Astro.props;
const { Content } = await article.render();

// Header image logic - uses provided image or generates a random one
const headerImage = article.data.headerImage || `https://source.unsplash.com/random/1200x320?sig=${Math.floor(Math.random()*1000)}`;
---

<BlogLayout title={article.data.title}>
	<!-- Page Header Section -->
	<PageHeader 
		title={article.data.title}
		description={article.data.description}
		date={article.data.date}
	/>

	<!-- Two Column Layout -->
	<div class="article-layout">
		<!-- Main Content Column (2/3 width) -->
		<main class="article-main">
			<article class="article-content">
				{headerImage && (
					<div class="article-header">
						<img src={headerImage} alt="" class="article-header-image" />
					</div>
				)}
				<div class="article-text" id="article-text">
					<Content />
				</div>
			</article>
		</main>

		<!-- Sidebar Column (1/3 width) -->
		<aside class="article-sidebar">
			<!-- WCAG Criteria Section -->
			{article.data.wcagCriteria && (
				<section class="sidebar-section">
					<h2>WCAG Criteria</h2>
					<ul class="wcag-list">
						{article.data.wcagCriteria.map((criterion) => (
							<li>
								<a href={criterion.url} target="_blank" rel="noopener">
									{criterion.code}: {criterion.title}
								</a>
							</li>
						))}
					</ul>
				</section>
			)}

			<!-- Key Takeaways Section -->
			{article.data.keyTakeaways && (
				<section class="sidebar-section">
					<h2>Key Takeaways</h2>
					<ul class="takeaways-list">
						{article.data.keyTakeaways.map((takeaway) => (
							<li>{takeaway}</li>
						))}
					</ul>
				</section>
			)}

			<!-- Who Benefits Section -->
			{article.data.whoBenefits && (
				<section class="sidebar-section">
					<h2>Who Benefits</h2>
					<ul class="benefits-list">
						{article.data.whoBenefits.map((benefit) => (
							<li>{benefit}</li>
						))}
					</ul>
				</section>
			)}

			<!-- Related Resources -->
			{article.data.relatedResources && (
				<section class="sidebar-section">
					<h2>Related Resources</h2>
					<ul class="resources-list">
						{article.data.relatedResources.map((resource) => (
							<li>
								<a href={resource.url} target="_blank" rel="noopener">
									{resource.title}
								</a>
							</li>
						))}
					</ul>
				</section>
			)}

			<!-- Further Reading -->
			{article.data.furtherReading && (
				<section class="sidebar-section">
					<h2>Further Reading</h2>
					<ul class="reading-list">
						{article.data.furtherReading.map((reading) => (
							<li>
								<a href={reading.url} target="_blank" rel="noopener">
									{reading.title}
								</a>
							</li>
						))}
					</ul>
				</section>
			)}
		</aside>
	</div>
</BlogLayout>

<style>


	/* Two Column Layout */
	.article-layout {
		display: grid;
		grid-template-columns: 2fr 1fr;
		gap: var(--spacing-3xl);
		max-width: var(--container-lg);
		margin: 0 auto;
		align-items: start;
	}

	/* Main Content Column */
	.article-main {
		min-width: 0; /* Prevents grid overflow */
	}
	.article-content {
		width: 100%;
	}
	/* Header image styling */
	.article-header {
		margin: 0 0 var(--spacing-xl);
		overflow: hidden;
		border-radius: var(--radius-lg);
	}
	.article-header-image {
		width: 100%;
		height: 300px;
		object-fit: cover;
		display: block;
	}

	/* Main content text styling */
	.article-text {
		font-size: var(--text-lg);
		line-height: var(--leading-relaxed);
		color: var(--fg);
	}
	.article-text h2 {
		font-size: var(--text-3xl);
		margin: var(--spacing-2xl) 0 var(--spacing-md);
		color: var(--fg);
	}
	.article-text h3 {
		font-size: var(--text-2xl);
		margin: var(--spacing-xl) 0 var(--spacing-lg);
		color: var(--fg);
	}
	.article-text h4 {
		font-size: var(--text-xl);
		margin: var(--spacing-lg) 0 var(--spacing-sm);
		color: var(--fg);
	}
	.article-text p {
		margin: 0 0 var(--spacing-2xl);
	}
	.article-text ul,
	.article-text ol {
		margin: var(--spacing-2xl) 0;
		padding-left: var(--spacing-2xl);
	}
	.article-text li {
		margin: var(--spacing-sm) 0;
	}
	.article-text blockquote {
		margin: var(--spacing-xl) 0;
		padding: var(--spacing-2xl);
		border-left: 4px solid var(--fg);
		background: var(--bg-muted);
		border-radius: 0 var(--radius-md) var(--radius-md) 0;
		font-style: italic;
	}
	/* Inline code styling */
	.article-text code {
		background: var(--bg-muted);
		padding: var(--spacing-xs) var(--spacing-sm);
		border-radius: var(--radius-sm);
		font-size: 0.9em;
		font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
	}
	
	/* Code block styling - for ```code blocks in markdown */
	.article-text pre {
		background: var(--bg-muted);
		padding: var(--spacing-2xl);
		border-radius: var(--radius-md);
		overflow-x: auto;
		margin: var(--spacing-xl) 0;
		border: 1px solid var(--border);
		/* Ensure proper spacing for code blocks */
		white-space: pre;
		word-wrap: normal;
	}
	/* Code inside pre blocks - removes background and padding from inline code */
	.article-text pre code {
		background: none;
		padding: 0;
		font-size: 0.9rem;
		line-height: 1.5;
		border-radius: 0;
	}
	.article-text img {
		max-width: 100%;
		height: auto;
		border-radius: var(--radius-md);
		margin: var(--spacing-xl) 0;
	}
	.article-text a {
		color: var(--link);
		text-decoration: underline;
		text-decoration-color: var(--link-underline);
		text-underline-offset: 0.2em;
		text-decoration-thickness: 2px;
	}
	.article-text a:hover,
	.article-text a:focus,
	.article-text a:active {
		color: var(--link-hover);
		text-decoration-color: var(--link-underline-hover);
		text-decoration-thickness: 3px;
	}

	/* Sidebar Styling */
	.article-sidebar {
		background: var(--bg-muted);
		border-radius: var(--radius-lg);
		padding: var(--spacing-lg);
		border: 1px solid var(--border);
		height: fit-content;
		margin: 0 0 var(--spacing-xl);
	}
	.sidebar-section {
		margin-bottom: var(--spacing-2xl);
	}
	.sidebar-section:last-child {
		margin-bottom: 0;
	}
	.sidebar-section h2 {
		font-size: var(--text-lg);
		margin: 0 0 var(--spacing-md);
		color: var(--fg);
		border-bottom: 2px solid var(--accent-primary);
		padding-bottom: var(--spacing-sm);
	}
	.sidebar-section ul {
		list-style: none;
		padding: 0;
		margin: 0;
	}
	.sidebar-section li {
		margin-bottom: var(--spacing-sm);
		padding: var(--spacing-sm);
		background: var(--bg);
		border-radius: var(--radius-sm);
		border: 1px solid var(--border);
		transition: all 0.2s ease;
	}
	.sidebar-section li:hover {
		border-color: var(--accent-primary);
		background: var(--bg);
	}
	.sidebar-section a {
		color: var(--fg);
		text-decoration: none;
		display: block;
		font-size: var(--text-sm);
		line-height: var(--leading-normal);
	}
	.sidebar-section a:hover,
	.sidebar-section a:focus,
	.sidebar-section a:active {
		color: var(--accent-primary);
		text-decoration: underline;
		text-decoration-color: var(--accent-primary);
		text-underline-offset: 0.2em;
		text-decoration-thickness: 2px;
	}

	/* Specific list styling */
	.wcag-list li {
		font-weight: 500;
	}

	.takeaways-list li,
	.benefits-list li {
		font-size: var(--text-sm);
		line-height: var(--leading-normal);
	}

	.resources-list li,
	.reading-list li {
		font-size: var(--text-sm);
	}

	/* Responsive Design */
	@media (max-width: 1024px) {
		.article-layout {
			grid-template-columns: 1fr;
			gap: var(--spacing-2xl);
		}
		
		.article-sidebar {
			position: static;
			order: 1; /* Move sidebar after main content on mobile */
		}
	}

	@media (max-width: 768px) {
		
		.article-header {
			margin: 0 0 var(--spacing-lg);
		}
		
		.article-header-image {
			height: 200px;
		}
		
		.article-text {
			font-size: var(--text-base);
		}
		
		.article-text h2 {
			font-size: var(--text-2xl);
		}
		
		.article-text h3 {
			font-size: var(--text-xl);
		}
		
		.article-sidebar {
			padding: var(--spacing-lg);
		}
		
		.sidebar-section h2 {
			font-size: var(--text-base);
		}
	}
</style> 